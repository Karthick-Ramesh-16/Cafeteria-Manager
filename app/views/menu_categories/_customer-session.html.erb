<article>
    <aside>
        <div class="CartItem-head">
            <h1 class="MenuCategory">Your Cart</h1>
            <%= form_with(url: clear_cart_path, method: "DELETE", class: "CartClear") do %>
                <%= submit_tag("Clear cart", class: "CartClear-button") %>
            <% end %>
        </div>

        <div class="CartItem-body">
            <% if @cart_items.present? %>
                <% @cart_items.each do |cart| %>
                    <% item = MenuItem.find(cart.menu_item_id) %>
                    <div class="CartItem-container">
                        <p class="CartItem-name"><%= item.name %></p>

                        <p class="CartItem-price">₹<%= item.price * cart.quantity %></p>

                        <div class="CartItem-quantity">
                            <%= form_with(url: change_quantity_path(id: cart.id, quantity: -1),
                                          method: "PUT", class: "ReduceQuantity") do %>
                                <%= submit_tag("-", class: "ReduceQuantity-button") %>
                            <% end %>

                            <span class="Quantity-number"><%= cart.quantity %></span>

                            <%= form_with(url: change_quantity_path(id: cart.id, quantity: 1),
                                          method: "PUT", class: "AddQuantity") do %>
                                <%= submit_tag("+", class: "AddQuantity-button") %>
                            <% end %>
                        </div>
                    </div>
                <% end %>
            <% else %>
                <h3 class="CartEmpty-text">Your Cart is empty</h3>
            <% end %>
        </div>

        <div class="Cart-checkout">
            <%= form_with(url: "/orders/#{CartItem.total_amount(@current_user.id)}",
                          method: "POST", class: "Checkout", style: "margin-bottom: 10px") do %>
                <label for="home_address">Destination:</label>
                <select name="destination">
                    <% @current_user.destinations.each do |address| %>
                        <option value='<%= address.destination %>'>
                            <%= address.destination %>
                        </option>
                    <% end %>
                </select>
                <label class="Cart-total">Total: ₹<%= CartItem.total_amount(@current_user.id) %>
                <%= submit_tag("Checkout", class: "Checkout-button") %>
            <% end %>
        </div>
    </aside>

    <section>
        <% menu_categories.each do |category| %>
            <% if category.status %>
                <h2 class="MenuCategory-title"><%= category.name %></h2>

                <ul class="MenuItem-list">
                    <% MenuItem.get_menu_items(category.id).each do |item| %>
                        <% if item.availability %>
                            <li><div class="MenuItem-container">
                                    <span class="MenuItem-title"><%= item.name %></span>
                                    <span class="MenuItem-price">₹<%= item.price %></span>
                                    <%= form_with(url: "/cart_items?menu_item_id=#{item.id}",
                                                  method: "POST", class: "AddCart") do %>
                                        <%= submit_tag("Add +", class: "AddCart-button") %>
                                    <% end %>
                                </div>
                                <p class="MenuItem-description"><%= item.description %>
                            </li>
                        <% end %>
                    <% end %>
                </ul>
            <% end %>
        <% end %>
    </section>
</article>

<script>
    function add_address() {
        alert("Add new addres");
    }
</script>